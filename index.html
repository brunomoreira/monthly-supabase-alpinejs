<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="favicon.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vite App</title>
        <link rel="stylesheet" id="theme-ref" />
    </head>
    <body>
        <div x-data="main">
            <!-- Navbar -->
            <nav
                class="navbar navbar-expand-lg navbar-dark bg-primary"
                id="navbar"
            >
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Monthly</a>
                    <button
                        class="navbar-toggler"
                        type="button"
                        aria-label="Toggle navigation"
                        data-bs-toggle="collapse"
                        data-bs-target="#navbar-main"
                    >
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div id="navbar-main" class="collapse navbar-collapse">
                        <ul class="navbar-nav me-auto">
                            <template x-if="$store.userStore.user">
                                <li class="nav-item">
                                    <a
                                        x-bind:class="$store.viewStore.view == 'dashboard' ? 'active' : ''"
                                        class="nav-link"
                                        href="#"
                                    >
                                        Dashboard
                                    </a>
                                </li>
                            </template>
                        </ul>
                        <div class="d-flex">
                            <div
                                x-data="() => ({
                                    init() {
                                        new Dropdown(this.$refs['theme-dropdown-toggle'])
                                    },
                                })"
                                class="nav-item dropdown"
                            >
                                <button
                                    x-ref="theme-dropdown-toggle"
                                    class="btn btn-link nav-link dropdown-toggle text-white ps-0"
                                    type="button"
                                    data-bs-toggle="dropdown"
                                >
                                    Themes
                                </button>
                                <div class="dropdown-menu" id="themes-dp-menu">
                                    <template
                                        x-for="theme in $store.themesStore.themes"
                                    >
                                        <button
                                            x-text="theme"
                                            x-on:click="$store.themesStore.change(theme)"
                                            class="btn btn-link dropdown-item w-75 mx-auto text-center mb-2"
                                            :class="theme == $store.themesStore.activeTheme ? 'active' : ''"
                                        ></button>
                                    </template>
                                </div>
                            </div>
                            <template x-if="$store.userStore.user">
                                <div
                                    x-data="() => ({
                                        init() {
                                            new Dropdown(this.$refs['navbar-dropdown-toggle'])
                                        },
                                    })"
                                    class="nav-item dropdown"
                                >
                                    <button
                                        x-ref="navbar-dropdown-toggle"
                                        x-text="$store.userStore.user?.email"
                                        class="btn btn-link nav-link dropdown-toggle text-white ps-0"
                                        type="button"
                                        data-bs-toggle="dropdown"
                                    ></button>
                                    <div class="dropdown-menu">
                                        <button
                                            x-on:click="showProfileModal()"
                                            class="btn btn-link dropdown-item w-75 mx-auto text-center"
                                        >
                                            Profile
                                        </button>
                                        <div class="dropdown-divider"></div>
                                        <button
                                            x-on:click="onLogout()"
                                            class="btn btn-link dropdown-item text-danger w-75 mx-auto text-center"
                                            type="button"
                                        >
                                            Logout
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- END:Navbar -->

            <!-- If user -->
            <template x-if="$store.userStore.user">
                <div>
                    <!-- Dashboard -->
                    <template x-if="$store.viewStore.view == 'dashboard'">
                        <div x-data="dashboard">
                            <!-- Add Product Form -->
                            <div
                                x-ref="add-product-form"
                                class="offcanvas offcanvas-end"
                                tabindex="-1"
                                aria-labelledby="offcanvasExampleLabel"
                            >
                                <div class="offcanvas-header">
                                    <h5 class="offcanvas-title">Add Product</h5>
                                    <button
                                        x-on:click="closeAddProduct()"
                                        type="button"
                                        class="btn-close text-reset"
                                        aria-label="Close"
                                    ></button>
                                </div>
                                <div class="offcanvas-body">
                                    <form x-on:submit.prevent="addProduct()">
                                        <div class="form-group">
                                            <label
                                                for="add-product-name"
                                                class="form-label mt-4"
                                                >Name</label
                                            >
                                            <input
                                                x-model="newProduct.name"
                                                type="text"
                                                class="form-control"
                                                id="add-product-name"
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label
                                                for="add-product-price"
                                                class="form-label mt-4"
                                                >Price</label
                                            >
                                            <input
                                                x-model.number="newProduct.price"
                                                type="number"
                                                min="0"
                                                class="form-control"
                                                id="add-product-price"
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label
                                                for="add-product-type"
                                                class="form-label mt-4"
                                                >Type</label
                                            >
                                            <select
                                                x-model="newProduct.type_id"
                                                class="form-select"
                                                id="add-product-type"
                                            >
                                                <option value="">-</option>
                                                <option value="11">
                                                    Animais
                                                </option>
                                                <option value="3">
                                                    Bebidas
                                                </option>
                                                <option value="7">Beb√©</option>
                                                <option value="5">
                                                    Beleza
                                                </option>
                                                <option value="10">Casa</option>
                                                <option value="6">
                                                    Congelados
                                                </option>
                                                <option value="4">
                                                    Frescos
                                                </option>
                                                <option value="8">
                                                    Higiene
                                                </option>
                                                <option value="2">
                                                    Lactic√≠nios
                                                </option>
                                                <option value="12">
                                                    Lazer
                                                </option>
                                                <option value="9">
                                                    Limpeza
                                                </option>
                                                <option value="1">
                                                    Mercearia
                                                </option>
                                                <option value="13">
                                                    Sa√∫de
                                                </option>
                                                <option value="14">
                                                    Indefinido
                                                </option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label
                                                for="add-product-date"
                                                class="form-label mt-4"
                                                >Date</label
                                            >
                                            <input
                                                x-ref="add-product-date-input"
                                                type="text"
                                                class="form-control"
                                                id="add-product-date"
                                            />
                                        </div>
                                        <div
                                            class="w-100 position-absolute start-0 d-flex justify-content-center align-items-center"
                                            style="bottom: 1rem"
                                        >
                                            <button
                                                x-on:click="resetForm()"
                                                type="button"
                                                class="btn btn-danger me-2"
                                            >
                                                Reset Form
                                            </button>
                                            <button
                                                type="submit"
                                                class="btn btn-primary"
                                            >
                                                Save Product
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- END: Add Product Form -->

                            <div class="container-lg mt-4 pb-4 pt-0 pt-sm-2">
                                <!-- Stats -->
                                <div x-data="stats" class="row mt-4">
                                    <div class="col-12 col-sm-4">
                                        <div
                                            class="card text-white bg-primary mb-3"
                                        >
                                            <div class="card-header">
                                                Average Month Spending
                                            </div>
                                            <div class="card-body">
                                                <h4
                                                    x-text="average"
                                                    class="card-title"
                                                ></h4>
                                                <p class="card-text fst-italic">
                                                    Average is calculated by
                                                    adding all of the month
                                                    totals of each available
                                                    year.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-4">
                                        <div
                                            class="card text-white bg-primary mb-3"
                                        >
                                            <div class="card-header">
                                                Most Popular Product
                                            </div>
                                            <div class="card-body">
                                                <h4
                                                    x-text="mostPopular?.mostPopularProduct.name"
                                                    class="card-title"
                                                ></h4>
                                                <p class="card-text fst-italic">
                                                    The total amount spent was
                                                    <span
                                                        x-text="mostPopular?.mostPopularProduct.total"
                                                    ></span>
                                                    .
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-4">
                                        <div
                                            class="card text-white bg-primary mb-3"
                                        >
                                            <div class="card-header">
                                                Most Popular Type
                                            </div>
                                            <div class="card-body">
                                                <h4
                                                    x-text="mostPopular?.mostPopularType.name"
                                                    class="card-title"
                                                ></h4>
                                                <p class="card-text fst-italic">
                                                    There is a total of
                                                    <span
                                                        x-text="mostPopular?.mostPopularType.total"
                                                    ></span>
                                                    <q
                                                        ><span
                                                            x-text="mostPopular?.mostPopularType.name"
                                                        ></span
                                                    ></q>
                                                    products.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- END: Stats -->

                                <!-- Graph -->
                                <template
                                    x-if="$store.productsStore.products.length > 0"
                                >
                                    <div class="row mt-5">
                                        <div class="col-12">
                                            <h3>
                                                Graph
                                                <small class="text-muted"
                                                    >with all the data!</small
                                                >
                                            </h3>
                                            <div
                                                x-data="graph"
                                                class="card py-4"
                                            >
                                                <div x-ref="graph-ref"></div>
                                                <div
                                                    id="graph-actions-wrapper"
                                                    class="d-flex justify-content-center align-items-center"
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END: Graph -->
                                </template>

                                <template
                                    x-if="$store.productsStore.products.length > 0"
                                >
                                    <!-- Table -->
                                    <div x-data="table">
                                        <div class="row mt-5">
                                            <div class="col-12">
                                                <div
                                                    class="d-flex justify-content-between align-items-center"
                                                >
                                                    <h3>
                                                        Table
                                                        <small
                                                            class="text-muted"
                                                            >with all the
                                                            data!</small
                                                        >
                                                    </h3>
                                                    <button
                                                        x-on:click="openAddProduct()"
                                                        class="btn btn-primary"
                                                    >
                                                        Add Product
                                                    </button>
                                                </div>
                                                <div class="mt-4 mb-2">
                                                    <input
                                                        x-model="search"
                                                        type="search"
                                                        class="form-control"
                                                        placeholder="Search product..."
                                                    />
                                                </div>
                                                <div>
                                                    <div
                                                        x-ref="table-ref"
                                                    ></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END: Table -->
                                </template>
                            </div>
                        </div>
                    </template>
                    <!-- END: Dashboard -->

                    <!-- Profile -->
                    <div
                        x-ref="profile-modal"
                        id="profile-modal"
                        class="modal fade"
                        tabindex="-1"
                        style="display: block"
                        aria-modal="true"
                        role="dialog"
                    >
                        <div class="modal-dialog modal-fullscreen">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title h4">Profile</h5>
                                    <button
                                        type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal"
                                        aria-label="Close"
                                    ></button>
                                </div>
                                <div class="modal-body">
                                    <div class="card">
                                        <div class="card-header">
                                            <h4>Data</h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-group mb-4">
                                                <span class="input-group-text"
                                                    >üìß</span
                                                >
                                                <input
                                                    x-bind:value="$store.userStore.user?.email"
                                                    type="email"
                                                    class="form-control"
                                                />
                                                <span class="input-group-text">
                                                    <button
                                                        class="btn btn-primary"
                                                    >
                                                        Update
                                                    </button>
                                                </span>
                                            </div>
                                            <div class="input-group mb-4">
                                                <span class="input-group-text"
                                                    >&#128227;</span
                                                >
                                                <input
                                                    x-bind:value="$store.userStore.user?.user_metadata?.username"
                                                    type="text"
                                                    class="form-control"
                                                />
                                                <span class="input-group-text">
                                                    <button
                                                        class="btn btn-primary"
                                                    >
                                                        Update
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <p>
                                        Lorem ipsum dolor sit amet consectetur
                                        adipisicing elit. Amet, ullam.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END: Profile -->
                </div>
            </template>

            <!-- If not user -->
            <template x-if="!$store.userStore.user">
                <div
                    class="position-fixed top-0 end-0 h-100 w-100 d-flex align-items-center justify-content-center"
                >
                    <div
                        x-data="() => ({
                        setView(view) {
                            this.$store.viewStore.setView(view)
                        } 
                    })"
                        class="card auth-form-wrapper"
                    >
                        <div class="card-header">
                            <template x-if="$store.viewStore.view == 'login'">
                                <h4>Login</h4>
                            </template>
                            <template x-if="$store.viewStore.view == 'signup'">
                                <h4>Signup</h4>
                            </template>
                        </div>
                        <div class="card-body">
                            <!-- Login View -->
                            <template x-if="$store.viewStore.view == 'login'">
                                <div x-data="loginForm">
                                    <div
                                        x-show="hasLoginError"
                                        class="alert alert-danger"
                                    >
                                        <strong>Oh snap!</strong>
                                        <span x-text="loginErrorMessage"></span
                                        >.
                                    </div>
                                    <form x-on:submit.prevent="onLogin()">
                                        <div class="form-group">
                                            <label
                                                class="form-label mt-1"
                                                for="email-login"
                                                >Email</label
                                            >
                                            <input
                                                x-model="email"
                                                x-ref="login-input-email"
                                                type="email"
                                                class="form-control"
                                                id="email-login"
                                            />
                                            <div
                                                x-ref="login-input-email-feedback"
                                                class="invalid-feedback"
                                            ></div>
                                        </div>
                                        <div class="form-group mt-2">
                                            <label
                                                class="form-label mt-1"
                                                for="password-login"
                                                >Password</label
                                            >
                                            <input
                                                x-model="password"
                                                x-ref="login-input-password"
                                                type="password"
                                                class="form-control"
                                                id="password-login"
                                            />
                                            <div
                                                x-ref="login-input-password-feedback"
                                                class="invalid-feedback"
                                            ></div>
                                        </div>
                                        <div
                                            class="d-flex justify-content-between align-items-center mt-4"
                                        >
                                            <button
                                                type="submit"
                                                class="btn btn-primary"
                                            >
                                                Login
                                            </button>
                                            <button
                                                x-on:click="setView('signup')"
                                                type="button"
                                                class="btn btn-link"
                                            >
                                                Signup
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </template>
                            <!-- END: Login View -->

                            <!-- Signup View -->
                            <template x-if="$store.viewStore.view == 'signup'">
                                <div x-data="signupForm">
                                    <div
                                        x-show="hasSignupError"
                                        class="alert alert-danger"
                                    >
                                        <strong>Oh snap!</strong>
                                        <span x-text="signupErrorMessage"></span
                                        >.
                                    </div>
                                    <form x-on:submit.prevent="onSignup()">
                                        <div class="form-group">
                                            <label
                                                class="form-label mt-1"
                                                for="email-signup"
                                                >Email</label
                                            >
                                            <input
                                                x-model="email"
                                                x-ref="signup-input-email"
                                                type="email"
                                                class="form-control"
                                                id="email-signup"
                                            />
                                            <div
                                                x-ref="signup-input-email-feedback"
                                                class="invalid-feedback"
                                            ></div>
                                        </div>
                                        <div class="form-group mt-2">
                                            <label
                                                class="form-label mt-1"
                                                for="username-signup"
                                                >Username</label
                                            >
                                            <input
                                                x-model="username"
                                                x-ref="signup-input-username"
                                                type="text"
                                                class="form-control"
                                                id="username-signup"
                                            />
                                            <div
                                                x-ref="signup-input-username-feedback"
                                                class="invalid-feedback"
                                            ></div>
                                        </div>
                                        <div class="form-group mt-2">
                                            <label
                                                class="form-label mt-1"
                                                for="password-signup"
                                                >Password</label
                                            >
                                            <input
                                                x-model="password"
                                                x-ref="signup-input-password"
                                                type="password"
                                                class="form-control"
                                                id="password-signup"
                                            />
                                            <div
                                                x-ref="signup-input-password-feedback"
                                                class="invalid-feedback"
                                            ></div>
                                        </div>
                                        <div class="form-group mt-2">
                                            <label
                                                class="form-label mt-1"
                                                for="password-confirmation-signup"
                                                >Password Confirmation</label
                                            >
                                            <input
                                                x-model="password_confirmation"
                                                x-ref="signup-input-password_confirmation"
                                                type="password"
                                                class="form-control"
                                                id="password-confirmation-signup"
                                            />
                                            <div
                                                x-ref="signup-input-password_confirmation-feedback"
                                                class="invalid-feedback"
                                            ></div>
                                        </div>
                                        <div
                                            class="d-flex justify-content-between align-items-center mt-4"
                                        >
                                            <button
                                                type="submit"
                                                class="btn btn-primary"
                                            >
                                                Signup
                                            </button>
                                            <button
                                                x-on:click="setView('login')"
                                                type="button"
                                                class="btn btn-link"
                                            >
                                                Login
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </template>
                            <!-- END: Signup View -->
                        </div>
                    </div>
                </div>
            </template>

            <template x-if="$store.userStore.user">
                <div x-data class="container-fluid container-sm">
                    <div class="row">
                        <div class="col-12">
                            <p class="w-100 text-center">
                                You are using the
                                <span
                                    class="fw-bold"
                                    x-text="$store.themesStore.activeTheme"
                                ></span>
                                theme!
                            </p>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        <script type="module" src="/src/main.ts"></script>
    </body>
</html>
